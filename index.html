<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Padre IANN | Confesionario Digital</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    /* Reset b√°sico */
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background-color: #121b22; /* WhatsApp dark bg */
      color: #e1e1e1;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* Banner privacidad (modal full screen) */
    #bannerPrivacidad {
      position: fixed;
      inset: 0;
      background: rgba(18, 27, 34, 0.95);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }

    #popup {
      background: #1e2a35;
      padding: 30px;
      border-radius: 10px;
      max-width: 90%;
      text-align: center;
      box-shadow: 0 0 20px #0f0;
      color: #d1d1d1;
    }

    #popup h2 {
      margin-top: 0;
      color: #25d366;
    }

    #popup p {
      font-size: 16px;
      margin-bottom: 20px;
      line-height: 1.4;
    }

    #popup button {
      padding: 12px 25px;
      font-size: 16px;
      background: #25d366;
      border: none;
      border-radius: 25px;
      cursor: pointer;
      color: #111;
      font-weight: 600;
      transition: background 0.3s;
    }
    #popup button:hover {
      background: #1ebe57;
    }

    /* Contenedor principal */
    #confesionario {
  max-width: 600px;
  margin: 0 auto;
  height: 100vh;
  display: flex;
  flex-direction: column;
  position: relative; /* para posicionar hijos si es necesario */
  padding: 0;
}

    /* Header */
    #confesionario h1 {
  flex: 0 0 60px;
  line-height: 60px;
  background: #075e54;
  margin: 0;
  padding: 0 20px;
  font-weight: 700;
  font-size: 1.4rem;
  color: white;
  text-align: center;
  user-select: none;
  box-shadow: 0 2px 4px rgb(0 0 0 / 0.2);
}
    /* √Årea mensajes (tipo chat) */
   #chatArea {
  flex: 1 1 auto;
  overflow-y: auto;
  padding: 15px 15px 10px;
  background: #111b21;
  display: flex;
  flex-direction: column;
  gap: 10px;
  scroll-behavior: smooth;
  margin-bottom: 70px; /* para que no quede tapado por el input fijo */
}


    /* Burbuja mensaje */
    .mensaje {
      max-width: 70%;
      padding: 10px 15px;
      border-radius: 20px;
      line-height: 1.3;
      word-wrap: break-word;
      font-size: 1rem;
      box-shadow: 0 1px 0.5px rgba(0, 0, 0, 0.13);
      user-select: text;
      animation: fadeInUp 0.3s ease forwards;
    }

    /* Mensaje del usuario */
    .mensaje.usuario {
      align-self: flex-end;
      background-color: #dcf8c6; /* verde claro WhatsApp */
      color: #111;
      border-bottom-right-radius: 5px;
      border-bottom-left-radius: 20px;
      border-top-left-radius: 20px;
      border-top-right-radius: 20px;
    }

    /* Mensaje Padre IANN */
    .mensaje.padre {
      align-self: flex-start;
      background-color: #2a3942;
      color: #e1e1e1;
      border-bottom-left-radius: 5px;
      border-bottom-right-radius: 20px;
      border-top-right-radius: 20px;
      border-top-left-radius: 20px;
    }

    /* Animaci√≥n burbuja */
    @keyframes fadeInUp {
      0% {
        opacity: 0;
        transform: translateY(10px);
      }
      100% {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* √Årea input + botones */
    #inputArea {
  position: fixed;
  bottom: 0;
  left: 50%;
  transform: translateX(-50%);
  width: 100%;
  max-width: 600px;
  background: #202c33;
  padding: 10px 15px;
  display: flex;
  gap: 8px;
  align-items: center;
  box-shadow: 0 -1px 5px rgb(0 0 0 / 0.3);
  z-index: 20;
}


    /* Textarea estilo WhatsApp */
    textarea#confesion {
  flex: 1;
  min-height: 40px;
  max-height: 120px;
  padding: 10px 15px;
  font-size: 16px;
  border-radius: 20px;
  border: none;
  resize: none;
  background: #323c42;
  color: white;
  font-family: inherit;
  outline: none;
  box-shadow: inset 0 1px 1px rgb(0 0 0 / 0.2);
  transition: background 0.3s;
}
    textarea#confesion::placeholder {
      color: #bbb;
    }
    textarea#confesion:focus {
      background: #4a5a63;
    }

    /* Botones enviar / dictar */
    button.enviar {
      background: #25d366;
      border: none;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      font-size: 20px;
      color: #fff;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.3s;
      user-select: none;
      box-shadow: 0 2px 5px rgb(0 0 0 / 0.3);
    }
    button.enviar:hover {
      background: #1ebe57;
    }
    button.enviar:active {
      background: #189e43;
    }
    button.enviar[disabled] {
      background: #9de4b3;
      cursor: not-allowed;
    }

    /* Botones donar y compartir */
    #btnDonar, #btnCompartir {
      position: fixed;
      bottom: 80px;
      width: 50px;
      height: 50px;
      font-size: 28px;
      border: none;
      border-radius: 50%;
      background: #202c33;
      color: #25d366;
      box-shadow: 0 0 8px #25d366;
      cursor: pointer;
      z-index: 9999;
      display: flex;
      align-items: center;
      justify-content: center;
      user-select: none;
      transition: background 0.3s;
    }
    #btnDonar:hover, #btnCompartir:hover {
      background: #25d366;
      color: #111;
      box-shadow: 0 0 15px #25d366;
    }
    #btnDonar {
      left: 20px;
    }
    #btnCompartir {
      right: 20px;
    }

    #popupDonar {
      position: fixed;
      bottom: 140px;
      left: 20px;
      width: 280px;
      background: #1e2a35;
      color: #d1d1d1;
      padding: 15px;
      border-radius: 10px;
      display: none;
      z-index: 9999;
      box-shadow: 0 0 15px #25d366;
      font-size: 14px;
      line-height: 1.4;
    }

    #popupDonar a {
      display: inline-block;
      margin-top: 10px;
      background: #25d366;
      padding: 10px 15px;
      color: #111;
      text-decoration: none;
      border-radius: 5px;
      font-weight: 600;
      transition: background 0.3s;
    }
    #popupDonar a:hover {
      background: #1ebe57;
    }

  </style>
</head>
<body>

<!-- Banner de privacidad -->
<div id="bannerPrivacidad">
  <div id="popup">
    <h2>Confesionario Digital</h2>
    <p>‚ÄúEste espacio no reemplaza tu fe. S√≥lo es una voz para acompa√±arte cuando el silencio pesa.‚Äù Esta confesi√≥n es completamente privada. No se almacenan datos personales ni grabaciones. Todo lo que digas ser√° procesado en el momento y luego descartado.</p>
    <button onclick="cerrarPrivacidad()">Entiendo y acepto</button>
  </div>
</div>

<!-- Confesionario -->
<div id="confesionario" style="display:none;">
  <h1>Padre IANN</h1>
  <div id="chatArea">
    <!-- Mensajes aparecer√°n aqu√≠ -->
    <div id="respuesta" style="display:none;"></div>
  </div>

  <div id="inputArea">
    <textarea id="confesion" placeholder="Contame qu√© te pasa..." rows="1" oninput="autoExpand(this)"></textarea>
    <button class="enviar" title="Dictar confesi√≥n" onclick="iniciarEscucha()">üéôÔ∏è</button>
    <button class="enviar" title="Enviar confesi√≥n" onclick="enviarConfesion()">üôè</button>
  </div>
</div>

  


<!-- Bot√≥n donar -->
<button id="btnDonar" title="Ayud√° a sostener este espacio">üíö</button>
<div id="popupDonar">
  <p>Si esta confesi√≥n te ayud√≥, pod√©s hacer una donaci√≥n voluntaria. Gracias por sostener este espacio üôè</p>
  <a href="https://www.mercadopago.com.ar/checkout/v1/redirect?pref_id=TU_PREF_ID" target="_blank">Hacer una donaci√≥n</a>
</div>

<!-- Bot√≥n compartir -->
<button id="btnCompartir" title="Compart√≠ con alguien que lo necesite">üì§</button>

<!-- Scripts -->
<script>
  function agregarMensaje(texto, tipo = "padre") {
  const burbuja = document.createElement("div");
  burbuja.className = `mensaje ${tipo}`;
  burbuja.textContent = texto;

  const chat = document.getElementById("chatArea");
  chat.appendChild(burbuja);
  // Mover scroll al final
  chat.scrollTop = chat.scrollHeight;
}
  function cerrarPrivacidad() {
    document.getElementById('bannerPrivacidad').style.display = 'none';
    document.getElementById('confesionario').style.display = 'block';
  }
// Auto expand textarea para que se comporte como WhatsApp
  function autoExpand(field) {
    field.style.height = 'auto';
    field.style.height = (field.scrollHeight) + 'px';
  }
async function enviarConfesion() {
  const texto = document.getElementById('confesion').value.trim();
  const respuestaDiv = document.getElementById('respuesta');

  if (!texto) {
    agregarMensaje("Por favor, escrib√≠ algo.", "padre");
    return;
  }

  agregarMensaje(texto, "usuario");
  document.getElementById('confesion').value = "";
  agregarMensaje("Padre IANN est√° reflexionando...", "padre");

  try {
    const response = await fetch("/.netlify/functions/api", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ pregunta: texto })
    });

    const data = await response.json();

    // Borrar el mensaje anterior "Padre IANN est√° reflexionando..."
    const chat = document.getElementById("chatArea");
    const ultimo = chat.lastElementChild;
    if (ultimo && ultimo.textContent === "Padre IANN est√° reflexionando...") {
      chat.removeChild(ultimo);
    }

    respuestaDiv.textContent = data.respuesta || "No pude responderte esta vez."; // Por compatibilidad
    agregarMensaje(respuestaDiv.textContent, "padre");
  } catch (error) {
    agregarMensaje("Hubo un error interno. Prob√° m√°s tarde.", "padre");
  }
}

  function iniciarEscucha() {
    if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
      alert("Tu navegador no soporta reconocimiento de voz.");
      return;
    }

    const reconocimiento = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
    reconocimiento.lang = 'es-AR';
    reconocimiento.interimResults = false;
    reconocimiento.maxAlternatives = 1;

    reconocimiento.onresult = function(event) {
      const textoDetectado = event.results[0][0].transcript;
      document.getElementById("confesion").value = textoDetectado;
    };

    reconocimiento.onerror = function(event) {
      alert("No se pudo usar el micr√≥fono. Prob√° de nuevo.");
    };

    reconocimiento.start();
  }

  // Bot√≥n Donar
  const btnDonar = document.getElementById("btnDonar");
  const popupDonar = document.getElementById("popupDonar");

  btnDonar.onclick = () => {
    popupDonar.style.display = popupDonar.style.display === 'none' ? 'block' : 'none';
  };

  // Bot√≥n Compartir
  const btnCompartir = document.getElementById("btnCompartir");

  btnCompartir.onclick = async () => {
    const url = window.location.href;
    const texto = "Prob√° el confesionario digital del Padre IANN. Te puede hacer bien. üôè";

    if (navigator.share) {
      try {
        await navigator.share({ title: "Padre IANN", text: texto, url });
      } catch (err) {
        alert("No se pudo compartir.");
      }
    } else {
      navigator.clipboard.writeText(url);
      alert("Enlace copiado para compartir üôå");
    }
  };
</script>

</body>
</html>
