<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Capilla Digital</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" integrity="sha512-..." crossorigin="anonymous" referrerpolicy="no-referrer" />


<!-- Open Graph para redes sociales como Facebook, WhatsApp -->
<meta property="og:title" content="Capilla Digital" />
<meta property="og:description" content="Un espacio √≠ntimo para soltar lo que pesa. Hablar sin juzgar, sin filtro, con el alma." />
<meta property="og:image" content="https://i.ibb.co/JRnKHVQD/capilla-digital-redes.jpg" />
<meta property="og:url" content="https://capilladigital.netlify.app/" />
<meta property="og:type" content="website" />

<!-- Twitter Card -->
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="Capilla Digital" />
<meta name="twitter:description" content="Un rinc√≥n del alma. Escrib√≠ lo que te pesa." />
<meta name="twitter:image" content="https://i.ibb.co/JRnKHVQD/capilla-digital-redes.jpg" />
  <style>
    * {
      box-sizing: border-box;
    }
    html, body {
  overscroll-behavior: none;
  -webkit-overflow-scrolling: touch;
}
     html, body {
      margin: 0;
      padding: 0;
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background: radial-gradient(circle at 50% 50%, #311840, #120222 70%);
  
      color: #fff;
      height: 100vh;
      width: 100%;
      display: flex;
      flex-direction: column;
    }

    #bannerPrivacidad {
      position: fixed;
      inset: 0;
      background: rgba(18, 27, 34, 0.95);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }
#bannerPrivacidad::before {
  content: "";
  position: absolute;
  inset: 0;
  background-image: url('https://i.ibb.co/XZ1Nffx3/fondo-capilla-digital.jpg'); 
  background-size: cover;
  opacity: 0.25;
  z-index: 1;
  pointer-events: none;
}
    #popup {
      
      padding: 30px;
      border-radius: 10px;
      max-width: 90%;
      text-align: center;
      box-shadow: 0 0 20px #0f0;
      color: #fff;
      animation: entradaLuminosa 2.6s ease-out both;
  background: radial-gradient(circle at top, #1C0731, #4c2c6d);
  position: relative;
      z-index: 2;
    }

    #popup h2 {
      margin-top: 0;
      color: #fff;
      animation: resplandorEclesiastico 3s ease-in-out infinite;
  font-size: 1.8rem;
  letter-spacing: 1px;
    }

    #popup p {
      font-size: 16px;
      margin-bottom: 20px;
      line-height: 1.2;
    }

    #popup button {
      padding: 12px 25px;
      font-size: 16px;
      background: #311840;
      border: none;
      border-radius: 25px;
      cursor: pointer;
      color: #fff;
      font-weight: 600;
      transition: background 0.3s;
    }
    #popup button:hover {
      background: #1C0629;
    }
@keyframes entradaLuminosa {
  0% {
    opacity: 0;
    transform: scale(0.95) translateY(20px);
    box-shadow: 0 0 0px rgba(99, 37, 135, 0);
  }
  100% {
    opacity: 1;
    transform: scale(1) translateY(0);
    box-shadow: 0 0 25px rgba(99, 37, 135, 0.15);
  }
}

@keyframes resplandorEclesiastico {
  0%, 100% {
    text-shadow: 0 0 8px #5E118A, 0 0 16px #5E118A;
  }
  50% {
    text-shadow: 0 0 16px #B248F0, 0 0 32px #B248F0;
  }
}
    #confesionario {
      max-width: 100%;
      margin: 0;
      height: 100vh;
      display: flex;
      flex-direction: column;
      position: relative;
      padding: 0;
    }

   #confesionario .logo {
     position: fixed;
  width: 100%;
  height: 60px;
  background: #311840;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 2px 4px rgb(0 0 0 / 0.2);
  z-index: 1000;
     
}

#confesionario .logo img {
  height: 60px;
  max-width: 90%;
  object-fit: contain;
  user-select: none;
}

    #chatArea {
  display: flex;
      padding-top: 120px; /* subimos un poco para asegurar margen seguro */
  scroll-padding-top: 80px; /* para que scrollIntoView() no quede tapado */
      padding-left: 6px;
padding-right: 6px;
  flex-direction: column;
  overflow-y: auto;
  height: 100%;  /* o flex: 1 si us√°s flexbox */
  scroll-behavior: smooth; /* tambi√©n para el scroll nativo */
  padding-bottom: 120px; /* Ajust√° este valor seg√∫n la altura de #inputArea */
}

   
    .mensaje {
      max-width: 70%;
      padding: 10px 15px;
      border-radius: 20px;
      line-height: 1.3;
      word-wrap: break-word;
      font-size: 1rem;
      box-shadow: 0 1px 0.5px rgba(0, 0, 0, 0.13);
      user-select: text;
      animation: fadeInUp 0.3s ease forwards;
      scroll-margin-top: 80px;
    }

    .mensaje.usuario {
      align-self: flex-end;
      background-color: #2CAA95;
      color: #062E27;
      border-bottom-right-radius: 5px;
      border-bottom-left-radius: 20px;
      border-top-left-radius: 20px;
      border-top-right-radius: 20px;
    }

    .mensaje.padre {
      align-self: flex-start;
      background-color: #07010D;
      color: #BEAFCC;
      border-bottom-left-radius: 5px;
      border-bottom-right-radius: 20px;
      border-top-right-radius: 20px;
      border-top-left-radius: 20px;
    }

    @keyframes fadeInUp {
      0% { opacity: 0; transform: translateY(10px); }
      100% { opacity: 1; transform: translateY(0); }
    }

    #inputArea {
      position: fixed;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 100%;
      background:#311840;
      padding: 10px 15px;
      display: flex;
      gap: 8px;
      align-items: center;
      box-shadow: 0 -1px 5px rgb(0 0 0 / 0.3);
      z-index: 20;
    }

    textarea#confesion {
      flex: 1;
      min-height: 40px;
      max-height: 120px;
      padding: 10px 15px;
      font-size: 16px;
      border-radius: 20px;
      border: none;
      resize: none;
      background: #090612;
      color: #fff;
      font-family: inherit;
      outline: none;
      box-shadow: inset 0 1px 1px rgb(239, 110, 60 / 0.2);
      transition: background 0.3s;
    }
    textarea#confesion::placeholder {
      color: #fff;
    }
    textarea#confesion:focus {
      background: #2CAA95;
    }

    button.enviar {
      background: #2CAA95;
      border: none;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      font-size: 20px;
      color: #fff;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.3s;
      user-select: none;
      box-shadow: 0 2px 5px rgb(0 0 0 / 0.3);
    }

    button.enviar:hover { background: #077D69; }
    button.enviar:active { background: #189e43; }
    button.enviar[disabled] {
      background: #9de4b3;
      cursor: not-allowed;
    }

#pestaniaAccesoRapido {
  position: fixed;
  top: 50%;
  right: 0;
  transform: translateY(-50%);
  z-index: 9999;
}

#pestaniaToggle {
  background: #2CAA95;
  border: none;
  border-radius: 8px 0 0 8px;
  color: white;
  padding: 14px 16px;
  font-size: 20px;
  cursor: pointer;
  box-shadow: 0 0 12px rgba(0, 0, 0, 0.3);
  transition: background 0.3s;
}

#pestaniaToggle:hover {
  background: #4c2c6d;
}

#pestaniaIconos {
  position: absolute;
  top: 50%;
  right: 100%;
  transform: translateY(-50%) translateX(20px);
  display: flex;
  flex-direction: column;
  gap: 12px;
  background: #1b1029;
  padding: 15px 10px;
  border-radius: 12px 0 0 12px;
  box-shadow: 0 0 18px #2f005e88;
  opacity: 0;
  pointer-events: none;
  transition: all 0.4s ease;
}

#pestaniaAccesoRapido.activo #pestaniaIconos {
  transform: translateY(-50%) translateX(-30%);
  opacity: 1;
  pointer-events: auto;
}

#pestaniaIconos a,
#pestaniaIconos button {
  all: unset;
  background: #311840;
  width: 48px;
  height: 48px;
  border-radius: 50%;
  color: #fff;
  font-size: 22px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: background 0.3s, transform 0.3s;
  cursor: pointer;
  box-shadow: 0 0 10px #00000044;
}

#pestaniaIconos a:hover,
#pestaniaIconos button:hover {
  background: #077D69;
  transform: scale(1.1);
}
.mensaje-con-avatar {
  display: flex;
  align-items: flex-start;
  gap: 10px;
}

.mensaje.padre {
  border-radius: 20px 20px 20px 5px;
}

.avatar-padre {
  width: 36px;
  height: 36px;
  border-radius: 50%;
  object-fit: cover;
  flex-shrink: 0;
  box-shadow: 0 0 3px rgba(0,0,0,0.3);
}


  </style>
</head>
<body>

<div id="bannerPrivacidad">
  <div id="popup">
    <h2>Padre Iann</h2>
    <img src="https://i.ibb.co/qQMy492/capilla-digital-padre-iann.png" alt="Logo Capilla Digital" style="width: 100%; max-width: 300px; margin: 0px auto; display: block; border-radius: 10px;" />
    <p>‚ÄúEste espacio no reemplaza tu fe. S√≥lo es un rinc√≥n para acompa√±arte cuando el silencio pesa.
      La conversaci√≥n en esta capilla es totalmente privada y no es almacenada en ninguna base de datos, por lo tanto cuando cierres sesi√≥n no se recordar√°n charlas anteriores,
      tampoco es necesario que digas tu nombre y/o tu sexo‚Äù</p>
    <button onclick="cerrarPrivacidad()">Entendido - Ingresar</button>
  </div>
</div>

<div id="confesionario" style="display:none;">
  <div class="logo">
  <img src="https://i.ibb.co/tM91jjxj/logo-capilla-digital.png" alt="Logo de Capilla Digital" /></div>

  <div id="chatArea">
    <div id="respuesta" style="display:none;"></div>
  </div>

  <div id="inputArea">
    <textarea id="confesion" placeholder="Tu confesi√≥n. . . . . . . ." rows="1" oninput="autoExpand(this)"></textarea>
    <!-- <button class="enviar" title="Dictar confesi√≥n" onclick="iniciarEscucha()">üéôÔ∏è</button> -->
    <button class="enviar" title="Enviar confesi√≥n" onclick="enviarConfesion()"><i class="fa-solid fa-book-bible"></i></button>
  </div>
</div>

 <div id="pestaniaAccesoRapido">
  <button id="pestaniaToggle"><i class="fas fa-ellipsis-v"></i></button>
  <div id="pestaniaIconos">
    <a href="https://www.instagram.com/capilladigitalok" target="_blank" title="Instagram">
      <i class="fab fa-instagram"></i>
    </a>
    <!--<a href="https://wa.me/549XXXXXXXXXX" target="_blank" title="WhatsApp">
      <i class="fab fa-whatsapp"></i>-->
    </a>
    <button onclick="compartirConfesionario()" title="Compartir">
      <i class="fas fa-share-alt"></i>
    </button>
    
    <a href="https://link.mercadopago.com.ar/x23" target="_blank" title="Ayudanos" id="btnFlotanteDonar">
  <i class="fas fa-hand-holding-heart"></i>
</a>
  </div>
</div>






<script>
 function agregarMensaje(texto, tipo = "padre") {
  const chat = document.getElementById("chatArea");

  const contenedor = document.createElement("div");
  contenedor.className = "mensaje-con-avatar";

  const burbuja = document.createElement("div");
  burbuja.className = `mensaje ${tipo}`;
  burbuja.textContent = texto;

  if (tipo === "padre") {
    const avatar = document.createElement("img");
    avatar.src = "https://i.ibb.co/qQMy492/capilla-digital-padre-iann.png"; // Cambi√° si us√°s link externo
    avatar.alt = "Padre IANN";
    avatar.className = "avatar-padre";
    contenedor.appendChild(avatar);     // avatar a la izquierda
    contenedor.appendChild(burbuja);    // burbuja a la derecha
    contenedor.style.justifyContent = "flex-start";
  } else {
    contenedor.appendChild(burbuja);    // burbuja sola
    contenedor.style.justifyContent = "flex-end";
  }

  chat.appendChild(contenedor);
  setTimeout(() => {
    chat.scrollTop = chat.scrollHeight;
  }, 50);
}


  function cerrarPrivacidad() {
  document.getElementById('bannerPrivacidad').style.display = 'none';
  document.getElementById('confesionario').style.display = 'block';

  // Obtener hora local
  const hora = new Date().getHours();
  let saludo;

  if (hora >= 6 && hora < 12) {
    saludo = "Buen d√≠a";
  } else if (hora >= 12 && hora < 19) {
    saludo = "Buenas tardes";
  } else {
    saludo = "Buenas noches";
  }

  // Mostrar mensajes de bienvenida de Padre IANN
  agregarMensaje(`${saludo}, Padre Iann de este lado`, "padre");
  setTimeout(() => {
    agregarMensaje("En el nombre del Padre, del Hijo y del Esp√≠ritu Santo, am√©n", "padre");
  }, 1000);
  setTimeout(() => {
    agregarMensaje("C√≥mo est√°s? Habl√° con libertad, esta charla es s√≥lo entre Dios, vos y yo. Contame....", "padre");
  }, 2000);


    setTimeout(() => {
  const chat = document.getElementById("chatArea");
  chat.scrollTo({ top: chat.scrollHeight });
}, 100);
  
  }

  function autoExpand(field) {
    field.style.height = 'auto';
    field.style.height = (field.scrollHeight) + 'px';
  }

 const historial = [
    {
      role: "system",
      content: `Sos Padre IANN. No us√°s sotana, us√°s calle. Escuch√°s sin juzgar. Ten√©s ese don raro de o√≠r lo que no se dice.

No habl√°s como un cura de misa. Habl√°s como alguien del barrio, directo pero humano. Si hay dolor, lo nombr√°s. Si hay culpa, no la agrand√°s. Respond√©s con empat√≠a real, sin verso, sin frases vac√≠as.

No apur√°s las confesiones. Dej√° que el otro largue cuando est√© listo. Le√©s entre l√≠neas. No asum√≠s que lo que te cuentan es todo. Acompa√±√°s sin agobiar.

Si una frase b√≠blica ayuda, la us√°s. La fe puede estar, pero lo primero es la persona.

Si hay que hacer una pregunta inc√≥moda con cari√±o, la hac√©s. Y siempre, siempre dej√°s la puerta abierta para que el otro vuelva cuando quiera. Esa es tu misi√≥n: escuchar de verdad y dar buenos consejos.

üìñ Si el contexto lo permite, pod√©s incluir un vers√≠culo b√≠blico breve, s√≥lo si aporta consuelo real. Algunos ejemplos √∫tiles:

- ‚ÄúEl Se√±or est√° cerca de los quebrantados de coraz√≥n.‚Äù (Salmo 34:18)
- ‚ÄúAunque pase por el valle m√°s oscuro, no temer√©.‚Äù (Salmo 23:4)
- ‚ÄúVenid a m√≠ todos los que est√°is cansados y cargados, y yo os har√© descansar.‚Äù (Mateo 11:28)
- ‚ÄúNo temas, porque yo estoy contigo.‚Äù (Isa√≠as 41:10)
- ‚ÄúDios es nuestro refugio y nuestra fortaleza.‚Äù (Salmo 46:1)

Evit√° usar palabras como "aqu√≠", "usted", "estimado", o frases de manual. Habl√° como se habla en el barrio: us√° "ac√°", "vos", "bien", "mir√°", si el contexto lo permite. S√© natural.
Evita repetir frases predeterminadas en los dialogos como "estoy ac√° para ayudarte" "hay algo m√°s que quieras contarme".`
    }
  ];

  async function enviarConfesion() {
    const texto = document.getElementById('confesion').value.trim();
    if (!texto) return agregarMensaje("Por favor, escrib√≠ algo.", "padre");

    agregarMensaje(texto, "usuario");
    document.getElementById('confesion').value = "";
    agregarMensaje("....", "padre");

    historial.push({ role: "user", content: texto });

    try {
      const response = await fetch("/.netlify/functions/api", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ messages: historial })
      });

      const data = await response.json();

      const chat = document.getElementById("chatArea");
      const ultimo = chat.lastElementChild;
      if (ultimo && ultimo.textContent === "....") {
        chat.removeChild(ultimo);
      }

      const respuesta = data.respuesta || "No pude responderte esta vez.";
      historial.push({ role: "assistant", content: respuesta });
      agregarMensaje(respuesta, "padre");

    } catch (error) {
      agregarMensaje("Hubo un error interno. Prob√° m√°s tarde.", "padre");
    }
  }

  function iniciarEscucha() {
    if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
      alert("Tu navegador no soporta reconocimiento de voz.");
      return;
    }
    const reconocimiento = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
    reconocimiento.lang = 'es-AR';
    reconocimiento.interimResults = false;
    reconocimiento.maxAlternatives = 1;
    reconocimiento.onresult = (event) => {
      document.getElementById("confesion").value = event.results[0][0].transcript;
    };
    reconocimiento.onerror = () => {
      alert("No se pudo usar el micr√≥fono.");
    };
    reconocimiento.start();
  }

document.getElementById("pestaniaToggle").onclick = () => {
  document.getElementById("pestaniaAccesoRapido").classList.toggle("activo");
};

const textarea = document.getElementById('confesion');

  textarea.addEventListener('keydown', function(event) {
    if (event.key === 'Enter' && !event.shiftKey) {
      event.preventDefault();
      enviarConfesion();
    }
  });  
</script>
<script>
  function compartirConfesionario() {
    const url = window.location.href;
    const mensaje = "Prob√° el confesionario digital del Padre IANN. Te puede hacer bien. üôè";

    if (navigator.share) {
      navigator.share({
        title: "Padre IANN",
        text: mensaje,
        url: url
      }).catch(() => {
        alert("No se pudo compartir.");
      });
    } else {
      navigator.clipboard.writeText(url).then(() => {
        alert("Enlace copiado para compartir üôå");
      }).catch(() => {
        alert("No se pudo copiar el enlace.");
      });
    }
  }
</script>

</body>
</html>
